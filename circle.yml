machine:
    python:
        version:
            3.5.1
    services:
        - docker
checkout:
  post:
    - git submodule sync
    - git submodule update --init
dependencies:
    pre:
        - pip install awscli
        - docker pull msh9/hugo-builder
deployment:
    publication:
        branch: master
        commands:
            - docker run -v $(pwd):/site:rw msh9/hugo-builder hugo
            - tar czf $CIRCLE_ARTIFACTS/codinginthetrenches.tar.gz public/*
            - aws s3 cp public s3://codinginthetrenches.com/ --recursive --exclude "*" --include "*.html" --include "*.xml" --content-language "en" --cache-control "max-age=3600"
            - aws s3 cp public s3://codinginthetrenches.com/ --recursive --exclude "*.html" --exclude "*.xml" --cache-control "max-age=43000"