machine:
    python:
        version:
            3.5.1
    services:
        - docker
dependencies:
    pre:
        - pip install pelican typogrify awscli
        - docker pull msh9/hugo-builder
deployment:
    publication:
        branch: master
        commands:
            - docker run -v ./:/site msh9/hugo-builder hugo -t hugo-icarus-theme
            - tar czf "${CIRCLE_ARTIFACTS}/codinginthetrenches.tar.gz" public/*
            - aws s3 cp public s3://$(S3_BUCKET)/ --recursive --exclude "*" --include "*.html" --content-language "en" --cache-control "max-age:3600"
	        - aws s3 cp public s3://$(S3_BUCKET)/ --recursive --exclude "*.html" --cache-control "max-age:43000"